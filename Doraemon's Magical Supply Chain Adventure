<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Â§öÂï¶AÂ§¢ÁöÑÂï§ÈÖíÈÅäÊà≤ | Doraemon's Beer Game üç∫</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap');
        
        :root {
            --doraemon-blue: #0066CC;
            --doraemon-light-blue: #4A90E2;
            --doraemon-white: #FFFFFF;
            --doraemon-red: #FF6B6B;
            --doraemon-yellow: #FFD93D;
            --doraemon-pink: #FF8FB1;
            --doraemon-green: #4ECDC4;
            --sky-blue: #87CEEB;
            --cloud-white: rgba(255, 255, 255, 0.9);
            --shadow-soft: 0 8px 32px rgba(0, 102, 204, 0.15);
            --shadow-medium: 0 12px 40px rgba(0, 102, 204, 0.2);
            --shadow-strong: 0 20px 60px rgba(0, 102, 204, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 50%, #E0F6FF 100%);
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        /* ËÉåÊôØÈõ≤ÊúµË£ùÈ£æ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(ellipse 150px 50px at 20% 10%, var(--cloud-white) 40%, transparent 50%),
                radial-gradient(ellipse 100px 40px at 70% 15%, var(--cloud-white) 40%, transparent 50%),
                radial-gradient(ellipse 120px 45px at 90% 25%, var(--cloud-white) 40%, transparent 50%),
                radial-gradient(ellipse 180px 60px at 30% 80%, var(--cloud-white) 40%, transparent 50%),
                radial-gradient(ellipse 140px 50px at 80% 90%, var(--cloud-white) 40%, transparent 50%);
            animation: cloudFloat 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes cloudFloat {
            0%, 100% { transform: translateX(0px) translateY(0px); }
            25% { transform: translateX(10px) translateY(-5px); }
            50% { transform: translateX(-5px) translateY(5px); }
            75% { transform: translateX(-10px) translateY(-3px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--cloud-white);
            border-radius: 30px;
            box-shadow: var(--shadow-strong);
            overflow: hidden;
            border: 3px solid var(--doraemon-blue);
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }

        /* Â§öÂï¶AÂ§¢È†≠ÈÉ®Ë®≠Ë®à */
        .header {
            background: linear-gradient(135deg, var(--doraemon-blue), var(--doraemon-light-blue));
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'ü§ñ';
            position: absolute;
            font-size: 8rem;
            opacity: 0.1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: headerIcon 3s ease-in-out infinite;
        }

        @keyframes headerIcon {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .doraemon-face {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .doraemon-head {
            width: 80px;
            height: 80px;
            background: var(--doraemon-blue);
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .doraemon-head::before {
            content: 'üëÅÔ∏è';
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.2rem;
        }

        .doraemon-head::after {
            content: 'üëÅÔ∏è';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.2rem;
        }

        .doraemon-nose {
            width: 12px;
            height: 12px;
            background: var(--doraemon-red);
            border-radius: 50%;
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            animation: noseGlow 1.5s ease-in-out infinite;
        }

        @keyframes noseGlow {
            0%, 100% { box-shadow: 0 0 5px var(--doraemon-red); }
            50% { box-shadow: 0 0 15px var(--doraemon-red); }
        }

        .title {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            font-weight: 600;
            opacity: 0.95;
            margin-bottom: 15px;
        }

        .game-info {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 25px;
            display: inline-block;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .main-content {
            padding: 40px 30px;
            background: linear-gradient(135deg, #F0F8FF, #E6F3FF);
        }

        /* Â§öÂï¶AÂ§¢È¢®Ê†ºÁöÑÂçÄÂ°ä */
        .doraemon-section {
            background: white;
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            border: 3px solid var(--doraemon-blue);
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .doraemon-section::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            height: 8px;
            background: linear-gradient(90deg, 
                var(--doraemon-yellow) 0%, 
                var(--doraemon-pink) 25%, 
                var(--doraemon-green) 50%, 
                var(--doraemon-red) 75%, 
                var(--doraemon-blue) 100%);
            border-radius: 25px 25px 0 0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--doraemon-blue);
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--doraemon-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            animation: iconSpin 4s ease-in-out infinite;
            border: 3px solid var(--doraemon-blue);
        }

        @keyframes iconSpin {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        .bilingual-text {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .text-zh {
            font-weight: 700;
            color: var(--doraemon-blue);
        }

        .text-en {
            font-size: 0.9rem;
            color: var(--doraemon-light-blue);
            font-weight: 600;
        }

        /* ÈÄ≤Â∫¶Ê¢ù - Â§öÂï¶AÂ§¢È¢®Ê†º */
        .progress-container {
            background: var(--doraemon-blue);
            border-radius: 50px;
            height: 20px;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--doraemon-yellow), var(--doraemon-green));
            transition: width 1s ease;
            position: relative;
            border-radius: 50px;
        }

        .progress-fill::after {
            content: 'üöÅ';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            animation: fly 2s ease-in-out infinite;
        }

        @keyframes fly {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            50% { transform: translateY(-60%) rotate(10deg); }
        }

        .progress-text {
            text-align: center;
            margin-top: 15px;
            font-weight: 700;
            color: var(--doraemon-blue);
            font-size: 1.2rem;
        }

        /* Áµ±Ë®àÂç°Áâá - ÈÅìÂÖ∑È¢®Ê†º */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, white, #F0F8FF);
            border-radius: 20px;
            padding: 25px 20px;
            text-align: center;
            border: 3px solid var(--doraemon-blue);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-strong);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            animation: cardShine 3s ease-in-out infinite;
        }

        @keyframes cardShine {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.2));
            animation: iconFloat 2s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--doraemon-blue);
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-weight: 700;
            color: var(--doraemon-light-blue);
            font-size: 0.95rem;
        }

        /* ÊàêÊú¨Âç°Áâá - Á¥ÖÂåÖÈ¢®Ê†º */
        .cost-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .cost-card {
            background: linear-gradient(135deg, var(--doraemon-red), var(--doraemon-pink));
            color: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 3px solid white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .cost-card:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: var(--shadow-strong);
        }

        .cost-card::before {
            content: 'üí∞';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2rem;
            opacity: 0.3;
            animation: coinSpin 3s linear infinite;
        }

        @keyframes coinSpin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        .cost-value {
            font-size: 2.8rem;
            font-weight: 900;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Ëº∏ÂÖ•ÂçÄÂüü - ‰ªªÊÑèÈñÄÈ¢®Ê†º */
        .input-section {
            background: linear-gradient(135deg, white, #E6F3FF);
            border: 4px solid var(--doraemon-blue);
            border-radius: 25px;
            padding: 35px;
            position: relative;
        }

        .input-section::before {
            content: 'üö™';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            background: var(--doraemon-pink);
            padding: 10px 15px;
            border-radius: 50%;
            border: 3px solid var(--doraemon-blue);
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            text-align: center;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--doraemon-blue);
            font-size: 1rem;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 3px solid var(--doraemon-light-blue);
            border-radius: 20px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, white, #F0F8FF);
            transition: all 0.3s ease;
            color: var(--doraemon-blue);
        }

        .input-group input:focus {
            border-color: var(--doraemon-yellow);
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 215, 61, 0.3);
            transform: scale(1.05);
            background: white;
        }

        .input-group input:hover:not(:focus) {
            border-color: var(--doraemon-green);
            transform: translateY(-2px);
        }

        #myOrder {
            border-color: var(--doraemon-red) !important;
            background: linear-gradient(135deg, #FFF0F0, white) !important;
            font-weight: 900 !important;
        }

        #myOrder:focus {
            border-color: var(--doraemon-yellow) !important;
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.3) !important;
        }

        /* ÊåâÈàï - ÈÅìÂÖ∑ÊåâÈàïÈ¢®Ê†º */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .doraemon-btn {
            padding: 18px 35px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
            min-width: 160px;
            border: 3px solid white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .doraemon-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .doraemon-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .doraemon-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow-strong);
        }

        .doraemon-btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        .btn-ai {
            background: linear-gradient(135deg, var(--doraemon-green), var(--sky-blue));
            color: white;
        }

        .btn-process {
            background: linear-gradient(135deg, var(--doraemon-blue), var(--doraemon-light-blue));
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, var(--doraemon-yellow), var(--doraemon-red));
            color: white;
        }

        /* AIÂª∫Ë≠∞ÂçÄÂüü - ÊôÇÂÖâÊ©üÈ¢®Ê†º */
        .ai-suggestion {
            background: linear-gradient(135deg, var(--doraemon-green), var(--sky-blue));
            color: white;
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 30px;
            display: none;
            position: relative;
            overflow: hidden;
            border: 3px solid white;
        }

        .ai-suggestion::before {
            content: 'üîÆ';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2.5rem;
            animation: crystal 2s ease-in-out infinite;
        }

        @keyframes crystal {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .suggestion-content {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        /* Ê≠∑Âè≤Ë®òÈåÑ - Ë®òÊÜ∂ÂêêÂè∏È¢®Ê†º */
        .history-section {
            background: linear-gradient(135deg, #FFFACD, #F0F8FF);
            border: 4px solid var(--doraemon-blue);
            border-radius: 25px;
            padding: 35px;
            position: relative;
            overflow: hidden;
        }

        .history-section::before {
            content: 'üìú';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            background: var(--doraemon-yellow);
            padding: 10px;
            border-radius: 50%;
            border: 3px solid var(--doraemon-blue);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            margin-top: 20px;
            border: 2px solid var(--doraemon-blue);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.9rem;
        }

        .history-table th {
            background: linear-gradient(135deg, #87CEEB, #B0E0E6);
            color: var(--doraemon-blue);
            padding: 15px 8px;
            text-align: center;
            font-weight: 800;
            position: sticky;
            top: 0;
            z-index: 1;
            border-right: 2px solid white;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .history-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid var(--doraemon-light-blue);
            border-right: 1px solid #E6F3FF;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .history-table tbody tr:nth-child(even) {
            background: #F0F8FF;
        }

        .history-table tbody tr:hover {
            background: var(--doraemon-yellow);
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Êá∏ÊµÆÊåâÈàï - Á´πËúªËúìÈ¢®Ê†º */
        .floating-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .floating-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 4px solid white;
            position: relative;
            overflow: hidden;
        }

        .floating-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: floatingGlow 2s ease-in-out infinite;
        }

        @keyframes floatingGlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .floating-btn:hover {
            transform: scale(1.2) rotate(10deg);
            box-shadow: var(--shadow-strong);
        }

        .floating-btn.help {
            background: linear-gradient(135deg, var(--doraemon-yellow), var(--doraemon-red));
        }

        .floating-btn.scroll-top {
            background: linear-gradient(135deg, var(--doraemon-blue), var(--doraemon-light-blue));
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .container {
                margin: 5px;
                border-radius: 20px;
            }
            
            .main-content {
                padding: 25px 20px;
            }
            
            .title {
                font-size: 2.2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                gap: 12px;
            }

            .doraemon-btn {
                min-width: auto;
                width: 100%;
            }

            .floating-actions {
                bottom: 20px;
                right: 15px;
            }

            .floating-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
        }

        /* ÁâπÊïàÂãïÁï´ */
        .animate-in {
            animation: slideInUp 0.8s ease-out forwards;
            opacity: 0;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ë¶èÂâáÂçÄÂüüÁâπÊÆäÊ®£Âºè */
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .rule-card {
            background: linear-gradient(135deg, white, #F0F8FF);
            border: 3px solid var(--doraemon-light-blue);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .rule-card:hover {
            transform: translateY(-5px);
            border-color: var(--doraemon-yellow);
            box-shadow: var(--shadow-medium);
        }

        .rule-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--doraemon-yellow), var(--doraemon-pink));
        }

        .rule-title {
            font-weight: 800;
            color: var(--doraemon-blue);
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rule-emoji {
            font-size: 1.5rem;
            animation: ruleFloat 2s ease-in-out infinite;
        }

        @keyframes ruleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        /* Âä†ËºâÂãïÁï´ */
        .loading {
            opacity: 0;
        }

        .loaded {
            opacity: 1;
            transition: opacity 0.8s ease-in-out;
        }

        /* Ë≠¶ÂëäÊèêÁ§∫Ê°Ü */
        .doraemon-alert {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--doraemon-yellow);
            color: var(--doraemon-blue);
            padding: 15px 25px;
            border-radius: 25px;
            border: 3px solid var(--doraemon-blue);
            z-index: 10000;
            font-weight: 800;
            box-shadow: var(--shadow-strong);
            animation: alertBounce 0.5s ease-out;
        }

        @keyframes alertBounce {
            0% { transform: translateX(-50%) translateY(-100px); }
            100% { transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body class="loading">
    <div class="container">
        <!-- Â§öÂï¶AÂ§¢È¢®Ê†ºÈ†≠ÈÉ® -->
        <header class="header">
            <div class="header-content">
                <div class="doraemon-face">
                    <div class="doraemon-head">
                        <div class="doraemon-nose"></div>
                    </div>
                </div>
                <h1 class="title">ü§ñ Â§öÂï¶AÂ§¢ÁöÑÂï§ÈÖíÈÅäÊà≤ üç∫</h1>
                <div class="subtitle">Doraemon's Magical Supply Chain Adventure | Â§öÂï¶AÂ§¢ÁöÑÁ•ûÂ•á‰æõÊáâÈèàÂÜíÈö™</div>
                <div class="game-info">
                    <i class="fas fa-user-tie"></i> Á∂ìÈä∑ÂïÜËßíËâ≤ Distributor Role 
                    <span style="margin: 0 15px;">‚Ä¢</span>
                    <i class="fas fa-target"></i> ÁõÆÊ®ôÔºöÁî®Á•ûÂ•áÈÅìÂÖ∑ÊúÄÂ∞èÂåñÊàêÊú¨ÔºÅGoal: Minimize costs with magical tools!
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- ÈÄ≤Â∫¶ÂçÄÂüü - ÊôÇÂÖâÈößÈÅì -->
            <div class="doraemon-section animate-in">
                <div class="section-title">
                    <div class="section-icon">üöÅ</div>
                    <div class="bilingual-text">
                        <span class="text-zh">ÊôÇÂÖâÈößÈÅìÈÄ≤Â∫¶</span>
                        <span class="text-en">Time Tunnel Progress</span>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">Week 0 / 60 | Á¨¨0ÈÄ± / 60ÈÄ±</div>
            </div>

            <!-- ÈÅäÊà≤Ë¶èÂâá - ÁôæÁßëÂÖ®Êõ∏ -->
            <div class="doraemon-section animate-in">
                <div class="section-title">
                    <div class="section-icon">üìö</div>
                    <div class="bilingual-text">
                        <span class="text-zh">Â§öÂï¶AÂ§¢ÁôæÁßëÂÖ®Êõ∏</span>
                        <span class="text-en">Doraemon's Encyclopedia</span>
                    </div>
                </div>
                <div class="rules-grid">
                    <div class="rule-card">
                        <div class="rule-title">
                            <span class="rule-emoji">üí∞</span>
                            <div class="bilingual-text">
                                <span class="text-zh">Á•ûÂ•áË®àÁÆóÂô®ÊàêÊú¨ÂÖ¨Âºè</span>
                                <span class="text-en">Magic Calculator Cost Formula</span>
                            </div>
                        </div>
                        <div class="bilingual-text">
                            <span class="text-zh">Â∫´Â≠òÊàêÊú¨ 0.5ÂÖÉ/ÂñÆ‰Ωç/ÈÄ±ÔºåÁº∫Ë≤®ÊàêÊú¨ 1ÂÖÉ/ÂñÆ‰Ωç/ÈÄ±</span>
                            <span class="text-en">Inventory: $0.5/unit/week, Shortage: $1.0/unit/week</span>
                        </div>
                    </div>
                    <div class="rule-card">
                        <div class="rule-title">
                            <span class="rule-emoji">üßÆ</span>
                            <div class="bilingual-text">
                                <span class="text-zh">Á∏ΩÊàêÊú¨È≠îÊ≥ïÂÖ¨Âºè</span>
                                <span class="text-en">Total Cost Magic Formula</span>
                            </div>
                        </div>
                        <div class="bilingual-text">
                            <span class="text-zh">(Â∫´Â≠ò+Âª∂ÈÅ≤1+Âª∂ÈÅ≤2) √ó 0.5 + Áº∫Ë≤®Èáè √ó 1.0</span>
                            <span class="text-en">(Inventory + Delay1 + Delay2) √ó 0.5 + Shortage √ó 1.0</span>
                        </div>
                    </div>
                    <div class="rule-card">
                        <div class="rule-title">
                            <span class="rule-emoji">üöÄ</span>
                            <div class="bilingual-text">
                                <span class="text-zh">ÊôÇÂÖâÊ©üÂª∂ÈÅ≤Á≥ªÁµ±</span>
                                <span class="text-en">Time Machine Delay System</span>
                            </div>
                        </div>
                        <div class="bilingual-text">
                            <span class="text-zh">Ë≤®Áâ©Á©øË∂äÊôÇÁ©∫ÔºöÂª∂ÈÅ≤2 ‚Üí Âª∂ÈÅ≤1 ‚Üí Â∫´Â≠ò</span>
                            <span class="text-en">Goods time travel: Delay2 ‚Üí Delay1 ‚Üí Inventory</span>
                        </div>
                    </div>
                    <div class="rule-card">
                        <div class="rule-title">
                            <span class="rule-emoji">‚ö†Ô∏è</span>
                            <div class="bilingual-text">
                                <span class="text-zh">Ë≠¶Â†±Âô®Áº∫Ë≤®ÊèêÈÜí</span>
                                <span class="text-en">Alarm for Shortage Alert</span>
                            </div>
                        </div>
                        <div class="bilingual-text">
                            <span class="text-zh">Áº∫Ë≤®ÊúÉËß∏ÁôºË≠¶Â†±ÔºåÁî¢ÁîüÈõôÂÄçÊá≤ÁΩ∞ÊàêÊú¨</span>
                            <span class="text-en">Shortages trigger alarms with double penalty costs</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÈÅìÂÖ∑ÁãÄÊÖãÁõ£Êéß -->
            <div class="doraemon-section animate-in">
                <div class="section-title">
                    <div class="section-icon">üìä</div>
                    <div class="bilingual-text">
                        <span class="text-zh">Á•ûÂ•áÈÅìÂÖ∑ÁãÄÊÖãÁõ£Êéß</span>
                        <span class="text-en">Magical Tools Status Monitor</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üïê</div>
                        <div class="stat-value" id="currentWeek">0</div>
                        <div class="stat-label">
                            <div class="bilingual-text">
                                <span class="text-zh">Áï∂ÂâçÈÄ±Êï∏ (Current Week)</span>
                                <span class="text-en">ÈÅäÊà≤ÈÄ≤Ë°åÁöÑÈÄ±Êï∏</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-value" id="inventory">4</div>
                        <div class="stat-label">
                            <div class="bilingual-text">
                                <span class="text-zh">Â∫´Â≠òÈáè (Inventory)</span>
                                <span class="text-en">ÂèØÁ´ãÂç≥Âá∫Ë≤®ÁöÑÂïÜÂìÅÊï∏Èáè</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è∞</div>
                        <div class="stat-value" id="delay1">4</div>
                        <div class="stat-label">
                            <div class="bilingual-text">
                                <span class="text-zh">Âª∂ÈÅ≤1 (Delay 1)</span>
                                <span class="text-en">‰∏ãÈÄ±ÊúÉÂà∞ÈÅîÁöÑË≤®Áâ©</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚åõ</div>
                        <div class="stat-value" id="delay2">4</div>
                        <div class="stat-label">
                            <div class="bilingual-text">
                                <span class="text-zh">Âª∂ÈÅ≤2 (Delay 2)</span>
                                <span class="text-en">ÂÖ©ÈÄ±ÂæåÊúÉÂà∞ÈÅîÁöÑË≤®Áâ©</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üö®</div>
                        <div class="stat-value" id="backorder">0</div>
                        <div class="stat-label">
                            <div class="bilingual-text">
                                <span class="text-zh">Áº∫Ë≤®Èáè (Shortage)</span>
                                <span class="text-en">ÁÑ°Ê≥ïÊªøË∂≥ÁöÑË®ÇÂñÆÊï∏Èáè</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊàêÊú¨Ê∞¥Êô∂ÁêÉ -->
            <div class="doraemon-section animate-in">
                <div class="section-title">
                    <div class="section-icon">üîÆ</div>
                    <div class="bilingual-text">
                        <span class="text-zh">È†êÁü•Ê∞¥Êô∂ÁêÉÊàêÊú¨ÂàÜÊûê</span>
                        <span class="text-en">Fortune Crystal Ball Cost Analysis</span>
                    </div>
                </div>
                <div class="cost-cards">
                    <div class="cost-card">
                        <div class="bilingual-text">
                            <span class="text-zh">Êú¨ÈÄ±ÊàêÊú¨ (Weekly Cost)</span>
                            <span class="text-en">Êú¨ÈÄ±Áî¢ÁîüÁöÑÁ∏ΩÊàêÊú¨</span>
                        </div>
                        <div class="cost-value" id="weeklyCost">6.0</div>
                        <small>ÂÖÉ / Dollars</small>
                    </div>
                    <div class="cost-card">
                        <div class="bilingual-text">
                            <span class="text-zh">Á¥ØÁ©çÁ∏ΩÊàêÊú¨ (Total Cost)</span>
                            <span class="text-en">ÂæûÈñãÂßãÁ¥ØÁ©çÁöÑÁ∏ΩÊàêÊú¨</span>
                        </div>
                        <div class="cost-value" id="totalCost">6.0</div>
                        <small>ÂÖÉ / Dollars</small>
                    </div>
                </div>
            </div>

            <!-- ‰ªªÊÑèÈñÄÊï∏ÊìöËº∏ÂÖ• -->
            <div class="doraemon-section animate-in">
                <div class="input-section">
                    <div class="section-title">
                        <div class="section-icon">üö™</div>
                        <div class="bilingual-text">
                            <span class="text-zh">‰ªªÊÑèÈñÄÊï∏ÊìöËº∏ÂÖ•ÂçÄ</span>
                            <span class="text-en">Anywhere Door Data Input Zone</span>
                        </div>
                    </div>
                    
                    <!-- Âü∫Á§éÊï∏ÊìöËº∏ÂÖ• -->
                    <h3 style="color: var(--doraemon-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span>üìä Êú¨ÈÄ±ÁôºÁîüÁöÑ‰∫ãÂØ¶Êï∏Êìö | Weekly Facts Data</span>
                    </h3>
                    <div class="input-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <div class="input-group">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">üè™ ÊâπÁôºÂïÜË®ÇÂñÆ (Wholesaler Order)</span>
                                    <span class="text-en">ÊâπÁôºÂïÜÂêëÊÇ®‰∏ãÁöÑË®ÇÂñÆÊï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="wholesalerOrder" min="0" placeholder="Êï∏Èáè">
                        </div>
                        <div class="input-group">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">üöö ÂØ¶ÈöõÂá∫Ë≤®Èáè (Actual Shipment)</span>
                                    <span class="text-en">ÊÇ®ÂØ¶ÈöõÂá∫Ë≤®ÁöÑÊï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="actualShip" min="0" placeholder="Êï∏Èáè">
                        </div>
                        <div class="input-group">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">üì¶ Êõ¥Êñ∞Â∫´Â≠ò (Updated Inventory)</span>
                                    <span class="text-en">Êú¨ÈÄ±ÁµêÊùüÂæåÁöÑÂ∫´Â≠òÊï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="newInventory" min="0" placeholder="Êï∏Èáè">
                        </div>
                        <div class="input-group">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">‚è∞ Êõ¥Êñ∞Âª∂ÈÅ≤1 (Updated Delay1)</span>
                                    <span class="text-en">‰∏ãÈÄ±ÊúÉÂà∞ÈÅîÁöÑË≤®Áâ©Êï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="newDelay1" min="0" placeholder="Êï∏Èáè">
                        </div>
                        <div class="input-group">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">‚åõ Êõ¥Êñ∞Âª∂ÈÅ≤2 (Updated Delay2)</span>
                                    <span class="text-en">ÂÖ©ÈÄ±ÂæåÊúÉÂà∞ÈÅîÁöÑË≤®Áâ©Êï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="newDelay2" min="0" placeholder="Êï∏Èáè">
                        </div>
                    </div>

                    <!-- AIÂª∫Ë≠∞ÊåâÈàï -->
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="doraemon-btn btn-ai" onclick="getAISuggestion()" style="font-size: 1.1rem; padding: 20px 40px;">
                            <i class="fas fa-robot"></i>
                            <div style="margin-left: 8px;">
                                üîÆ AIÊô∫ËÉΩÂª∫Ë≠∞<br>AI Magic Advice
                            </div>
                        </button>
                        <p style="margin-top: 10px; color: var(--doraemon-light-blue); font-weight: 600;">
                            üí° Âª∫Ë≠∞ÂÖàÁç≤ÂèñAIÁ≠ñÁï•ÂàÜÊûêÔºåÂÜçÊ±∫ÂÆöË®ÇË≥ºÊï∏Èáè<br>
                            üí° Get AI strategy analysis first, then decide order quantity
                        </p>
                    </div>

                    <!-- Ê±∫Á≠ñËº∏ÂÖ•ÂçÄ -->
                    <div style="background: linear-gradient(135deg, #FFF0F0, #FFE6E6); border: 3px solid var(--doraemon-red); border-radius: 20px; padding: 25px; margin-top: 30px; position: relative;">
                        <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--doraemon-red); color: white; padding: 8px 20px; border-radius: 20px; font-weight: 800; font-size: 0.9rem;">
                            üéØ ÈáçË¶ÅÊ±∫Á≠ñ Important Decision
                        </div>
                        
                        <h3 style="color: var(--doraemon-red); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; justify-content: center; margin-top: 10px;">
                            <span>üß† Âü∫ÊñºÂàÜÊûêÁöÑÁ≠ñÁï•Ê±∫Á≠ñ | Strategic Decision Based on Analysis</span>
                        </h3>
                        
                        <div class="input-group" style="max-width: 300px; margin: 0 auto;">
                            <label>
                                <div class="bilingual-text">
                                    <span class="text-zh">üè≠ ÊàëÁöÑÂ∑•Âª†Ë®ÇÂñÆ (My Factory Order)</span>
                                    <span class="text-en">Âü∫ÊñºAIÂª∫Ë≠∞ÔºåÊÇ®Ë¶ÅÂêëÂ∑•Âª†Ë®ÇË≥ºÁöÑÊï∏Èáè</span>
                                </div>
                            </label>
                            <input type="number" id="myOrder" min="0" placeholder="Ë®ÇË≥ºÈáè" style="border-color: var(--doraemon-red) !important; font-size: 1.4rem !important; font-weight: 900 !important;">
                        </div>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <p style="color: var(--doraemon-red); font-weight: 700; font-size: 0.9rem;">
                                ‚ö†Ô∏è ÈÄôÂÄãÊ±∫Á≠ñÂ∞áÂΩ±ÈüøÊú™‰æÜÂπæÈÄ±ÁöÑÂ∫´Â≠òÂíåÊàêÊú¨<br>
                                ‚ö†Ô∏è This decision will affect future weeks' inventory and costs
                            </p>
                        </div>
                    </div>

                    <!-- Âü∑Ë°åÊåâÈàï -->
                    <div class="button-group" style="margin-top: 30px;">
                        <button class="doraemon-btn btn-process" onclick="processWeek()">
                            <i class="fas fa-magic"></i>
                            <div style="margin-left: 8px;">
                                ‚ú® ÊñΩÂ±ïÈ≠îÊ≥ï<br>Cast Magic
                            </div>
                        </button>
                        <button class="doraemon-btn btn-reset" onclick="resetGame()">
                            <i class="fas fa-redo-alt"></i>
                            <div style="margin-left: 8px;">
                                üåÄ ÊôÇÂÖâÈáçÁΩÆ<br>Time Reset
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- AIÂç†ÂçúÂçÄÂüü -->
            <div class="ai-suggestion" id="aiSuggestion">
                <div class="section-title" style="color: white; margin-bottom: 20px;">
                    <div class="section-icon" style="background: rgba(255,255,255,0.3);">üîÆ</div>
                    <div class="bilingual-text">
                        <span class="text-zh">Â§öÂï¶AÂ§¢AIÊô∫ËÉΩÂç†Âçú</span>
                        <span class="text-en">Doraemon AI Fortune Telling</span>
                    </div>
                </div>
                <div class="suggestion-content" id="suggestionContent">
                    <!-- AIÂª∫Ë≠∞ÂÖßÂÆπÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                </div>
            </div>

            <!-- Ë®òÊÜ∂ÂêêÂè∏Ê≠∑Âè≤Ë®òÈåÑ -->
            <div class="doraemon-section animate-in">
                <div class="history-section">
                    <div class="section-title">
                        <div class="section-icon">üìú</div>
                        <div class="bilingual-text">
                            <span class="text-zh">Ë®òÊÜ∂ÂêêÂè∏Ê≠∑Âè≤Ë®òÈåÑ</span>
                            <span class="text-en">Memory Bread History Records</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">ÈÄ±Êï∏</span>
                                            <span class="text-en">Week</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">ÊâπÁôºÂïÜË®ÇÂñÆ</span>
                                            <span class="text-en">Wholesaler Order</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">ÂØ¶ÈöõÂá∫Ë≤®</span>
                                            <span class="text-en">Actual Ship</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">ÊàëÁöÑË®ÇÂñÆ</span>
                                            <span class="text-en">My Order</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">Â∫´Â≠ò</span>
                                            <span class="text-en">Inventory</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">Âª∂ÈÅ≤1</span>
                                            <span class="text-en">Delay1</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">Âª∂ÈÅ≤2</span>
                                            <span class="text-en">Delay2</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">Áº∫Ë≤®</span>
                                            <span class="text-en">Shortage</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">ÈÄ±ÊàêÊú¨</span>
                                            <span class="text-en">Week Cost</span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="bilingual-text">
                                            <span class="text-zh">Á¥ØÁ©çÊàêÊú¨</span>
                                            <span class="text-en">Total Cost</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <tr>
                                    <td>0</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>4</td>
                                    <td>0</td>
                                    <td>6.0</td>
                                    <td>6.0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Á´πËúªËúìÊá∏ÊµÆÊåâÈàï -->
    <div class="floating-actions">
        <div class="floating-btn help" onclick="showGameHelp()" title="Â§öÂï¶AÂ§¢Âπ´Âä© Doraemon Help">
            ü§ñ
        </div>
        <div class="floating-btn scroll-top" onclick="scrollToTop()" title="Á´πËúªËúìÂõûÈ†ÇÈÉ® Bamboo-copter to Top">
            üöÅ
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ
        let gameState = {
            currentWeek: 0,
            inventory: 4,
            delay1: 4,
            delay2: 4,
            backorder: 0,
            weeklyCost: 6.0,
            totalCost: 6.0,
            history: []
        };

        // È†ÅÈù¢ËºâÂÖ•ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËºâÂÖ•ÂãïÁï´
            setTimeout(() => {
                document.body.classList.remove('loading');
                document.body.classList.add('loaded');
                
                // ‰æùÂ∫èÈ°ØÁ§∫ÂãïÁï´
                const elements = document.querySelectorAll('.animate-in');
                elements.forEach((el, index) => {
                    setTimeout(() => {
                        el.style.animationDelay = `${index * 0.1}s`;
                    }, index * 100);
                });
            }, 500);

            // Ë®≠ÂÆöÁ¨¨‰∏ÄÈÄ±È†êË®≠Êï∏Êìö
            setDefaultWeekData();
            updateDisplay();
            updateProgressBar();
        });

        function setDefaultWeekData() {
            document.getElementById('wholesalerOrder').value = 0;
            document.getElementById('actualShip').value = 0;
            document.getElementById('myOrder').value = '';  // ‰øùÊåÅÁ©∫ÁôΩÔºåËÆìÁî®Êà∂Ê±∫Á≠ñ
            document.getElementById('newInventory').value = 8;
            document.getElementById('newDelay1').value = 4;
            document.getElementById('newDelay2').value = 0;
        }

        function calculateCost(inventory, delay1, delay2, backorder) {
            const inventoryCost = (inventory + delay1 + delay2) * 0.5;
            const backorderCost = backorder * 1.0;
            return inventoryCost + backorderCost;
        }

        function updateDisplay() {
            // Êõ¥Êñ∞Êï∏ÂÄºÈ°ØÁ§∫‰∏¶Ê∑ªÂä†Â§öÂï¶AÂ§¢È¢®Ê†ºÂãïÁï´
            const elements = ['currentWeek', 'inventory', 'delay1', 'delay2', 'backorder', 'weeklyCost', 'totalCost'];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                const currentValue = element.textContent;
                let newValue;
                
                switch(id) {
                    case 'currentWeek':
                        newValue = gameState.currentWeek;
                        break;
                    case 'inventory':
                        newValue = gameState.inventory;
                        break;
                    case 'delay1':
                        newValue = gameState.delay1;
                        break;
                    case 'delay2':
                        newValue = gameState.delay2;
                        break;
                    case 'backorder':
                        newValue = gameState.backorder;
                        break;
                    case 'weeklyCost':
                        newValue = gameState.weeklyCost.toFixed(1);
                        break;
                    case 'totalCost':
                        newValue = gameState.totalCost.toFixed(1);
                        break;
                }
                
                if (currentValue !== newValue.toString()) {
                    element.style.transform = 'scale(1.2) rotate(5deg)';
                    element.style.color = 'var(--doraemon-red)';
                    setTimeout(() => {
                        element.textContent = newValue;
                        element.style.transform = 'scale(1) rotate(0deg)';
                        element.style.color = '';
                    }, 200);
                }
            });
        }

        function updateProgressBar() {
            const progress = (gameState.currentWeek / 60) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Week ${gameState.currentWeek} / 60 | Á¨¨${gameState.currentWeek}ÈÄ± / 60ÈÄ± üöÅ`;
        }

        function getAISuggestion() {
            const wholesalerOrder = parseInt(document.getElementById('wholesalerOrder').value) || 0;
            const actualShip = parseInt(document.getElementById('actualShip').value) || 0;
            const newInventory = parseInt(document.getElementById('newInventory').value) || 0;
            const newDelay1 = parseInt(document.getElementById('newDelay1').value) || 0;
            const newDelay2 = parseInt(document.getElementById('newDelay2').value) || 0;

            // Ê™¢Êü•Âü∫Á§éÊï∏ÊìöÊòØÂê¶Â∑≤Ëº∏ÂÖ•
            if (isNaN(wholesalerOrder) || isNaN(actualShip) || isNaN(newInventory) || isNaN(newDelay1) || isNaN(newDelay2)) {
                showDoraemonAlert('ü§ñ Â§öÂï¶AÂ§¢ÊèêÈÜíÔºöË´ãÂÖàÂ°´ÂÖ•‰∏äÊñπÁöÑ‰∫ãÂØ¶Êï∏ÊìöÔºÅ\nDoraemon reminds: Please fill in the facts data above first!', 'warning');
                return;
            }

            const newBackorder = Math.max(0, gameState.backorder + wholesalerOrder - actualShip);
            
            let suggestion = generateDoraemonAISuggestion(wholesalerOrder, newInventory, newDelay1, newDelay2, newBackorder);
            
            document.getElementById('suggestionContent').innerHTML = suggestion;
            document.getElementById('aiSuggestion').style.display = 'block';
            
            // Âπ≥ÊªëÊªæÂãïÂà∞AIÂª∫Ë≠∞ÂçÄÂüü
            document.getElementById('aiSuggestion').scrollIntoView({ 
                behavior: 'smooth',
                block: 'center'
            });
        }

        function applySuggestedOrder(suggestedOrder) {
            document.getElementById('myOrder').value = suggestedOrder;
            
            // Ë¶ñË¶∫ÂèçÈ•ã - ËÆìËº∏ÂÖ•Ê°ÜÈñÉÁàç‰∏Ä‰∏ã
            const orderInput = document.getElementById('myOrder');
            orderInput.style.background = 'linear-gradient(135deg, var(--doraemon-yellow), #FFE6B3)';
            orderInput.style.transform = 'scale(1.1)';
            orderInput.style.boxShadow = '0 0 20px rgba(255, 215, 61, 0.6)';
            
            setTimeout(() => {
                orderInput.style.background = '';
                orderInput.style.transform = '';
                orderInput.style.boxShadow = '';
            }, 1000);
            
            // È°ØÁ§∫ÊàêÂäüÊèêÁ§∫
            showDoraemonAlert(`‚úÖ AIÂª∫Ë≠∞Â∑≤Êé°Áî®ÔºÅË®ÇË≥ºÊï∏ÈáèË®≠ÁÇ∫ ${suggestedOrder}\n‚úÖ AI suggestion applied! Order quantity set to ${suggestedOrder}`, 'success');
            
            // ÊªæÂãïÂà∞Ë®ÇÂñÆËº∏ÂÖ•ÂçÄÂüü
            document.getElementById('myOrder').scrollIntoView({ 
                behavior: 'smooth',
                block: 'center'
            });
        }

        function generateDoraemonAISuggestion(wholesalerOrder, inventory, delay1, delay2, backorder) {
            let totalInPipeline = delay1 + delay2;
            let suggestedOrder = 0;
            let reasoning = "";

            // Ë®àÁÆóÊ≠∑Âè≤Âπ≥ÂùáÈúÄÊ±Ç
            let recentDemands = gameState.history.slice(-4).map(h => h.wholesalerOrder);
            let avgDemand = recentDemands.length > 0 ? 
                recentDemands.reduce((a, b) => a + b, 0) / recentDemands.length : wholesalerOrder;

            let targetInventory = Math.ceil(avgDemand * 2);

            // Â§öÂï¶AÂ§¢È¢®Ê†ºÁöÑAIÂª∫Ë≠∞
            if (backorder > 0) {
                suggestedOrder = backorder + wholesalerOrder + targetInventory - totalInPipeline;
                reasoning = generateDoraemonShortageStrategy(backorder, wholesalerOrder, targetInventory, totalInPipeline, suggestedOrder);
            } else if (inventory < targetInventory) {
                let shortfall = targetInventory - inventory;
                suggestedOrder = Math.max(0, shortfall + avgDemand - totalInPipeline);
                reasoning = generateDoraemonReplenishmentStrategy(shortfall, avgDemand, totalInPipeline, suggestedOrder);
            } else if (inventory > targetInventory * 1.5) {
                suggestedOrder = Math.max(0, Math.ceil(avgDemand * 0.5) - totalInPipeline);
                reasoning = generateDoraemonCostControlStrategy(inventory, avgDemand, totalInPipeline, suggestedOrder);
            } else {
                suggestedOrder = Math.max(0, Math.ceil(avgDemand) - totalInPipeline + (targetInventory - inventory));
                reasoning = generateDoraemonStableStrategy(avgDemand, targetInventory, inventory, totalInPipeline, suggestedOrder);
            }

            let currentCost = calculateCost(inventory, delay1, delay2, backorder);
            let costAnalysis = generateDoraemonCostAnalysis(currentCost, inventory, delay1, delay2, backorder);
            
            let actionButton = `
                <div style="margin-top: 30px; text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; border: 2px solid rgba(255,255,255,0.3);">
                    <button onclick="applySuggestedOrder(${suggestedOrder})" style="
                        background: linear-gradient(135deg, var(--doraemon-yellow), var(--doraemon-red));
                        color: white;
                        border: none;
                        padding: 15px 30px;
                        border-radius: 25px;
                        font-size: 1.2rem;
                        font-weight: 800;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        border: 3px solid white;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        ‚ú® Êé°Áî®Âª∫Ë≠∞ÔºöË®ÇË≥º ${suggestedOrder} ÂñÆ‰Ωç<br>
                        ‚ú® Apply Suggestion: Order ${suggestedOrder} Units
                    </button>
                    <p style="margin-top: 10px; opacity: 0.8; font-size: 0.9rem;">
                        ÈªûÊìäÊ≠§ÊåâÈàïÂ∞áËá™ÂãïÂ°´ÂÖ•Âª∫Ë≠∞ÁöÑË®ÇË≥ºÊï∏Èáè<br>
                        Click to automatically fill in the suggested order quantity
                    </p>
                </div>`;

            return reasoning + costAnalysis + actionButton;
        }

        function generateDoraemonShortageStrategy(backorder, wholesalerOrder, targetInventory, totalInPipeline, suggestedOrder) {
            return `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.4rem;">
                        üö® <span>Á∑äÊÄ•ÔºÅ‰ΩøÁî®Á´πËúªËúìÂø´ÈÄüË£úË≤®Á≠ñÁï•ÔºÅ</span>
                    </h4>
                    <h5 style="margin-bottom: 10px; opacity: 0.9; font-size: 1.1rem;">
                        Emergency! Use Bamboo-copter Fast Restocking Strategy!
                    </h5>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid rgba(255,255,255,0.4);">
                        <p style="font-size: 1.3rem; font-weight: 800; margin-bottom: 10px; text-align: center;">
                            üéØ <strong>Â§öÂï¶AÂ§¢Âª∫Ë≠∞Á´ãÂç≥Ë®ÇË≥º ${suggestedOrder} ÂÄãÁ•ûÂ•áÂñÆ‰ΩçÔºÅ</strong>
                        </p>
                        <p style="font-size: 1.1rem; font-weight: 600; text-align: center; opacity: 0.9;">
                            Doraemon suggests ordering ${suggestedOrder} magic units immediately!
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                ü§ñ <span>Â§öÂï¶AÂ§¢ÁöÑÁ•ûÂ•áÂàÜÊûê</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üö® Á∑äÊÄ•Ë£úË∂≥Áº∫Ë≤®Ôºö${backorder} ÂñÆ‰Ωç</li>
                                <li>üè™ ÊªøË∂≥ÊâπÁôºÂïÜÈúÄÊ±ÇÔºö${wholesalerOrder} ÂñÆ‰Ωç</li>
                                <li>üõ°Ô∏è Âª∫Á´ãÂÆâÂÖ®Èò≤Ë≠∑Â∫´Â≠òÔºö${targetInventory} ÂñÆ‰Ωç</li>
                                <li>‚è∞ ÊôÇÂÖâÊ©üÂú®ÈÄîË≤®Áâ©Ôºö${totalInPipeline} ÂñÆ‰Ωç</li>
                                <li><strong style="color: var(--doraemon-yellow);">üî• Âç±Èö™Á≠âÁ¥öÔºöÈùûÂ∏∏È´òÔºÅ</strong></li>
                            </ul>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üåü <span>Doraemon's Magic Analysis</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üö® Emergency shortage cover: ${backorder} units</li>
                                <li>üè™ Meet wholesaler demand: ${wholesalerOrder} units</li>
                                <li>üõ°Ô∏è Build safety stock: ${targetInventory} units</li>
                                <li>‚è∞ Time machine pipeline: ${totalInPipeline} units</li>
                                <li><strong style="color: var(--doraemon-yellow);">üî• Risk Level: Very High!</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>`;
        }

        function generateDoraemonReplenishmentStrategy(shortfall, avgDemand, totalInPipeline, suggestedOrder) {
            return `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.4rem;">
                        üìà <span>‰ΩøÁî®ÊîæÂ§ßÈè°Á≤æÊòéË£úË≤®Á≠ñÁï•ÔºÅ</span>
                    </h4>
                    <h5 style="margin-bottom: 10px; opacity: 0.9; font-size: 1.1rem;">
                        Use Magnifying Glass Smart Replenishment Strategy!
                    </h5>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid rgba(255,255,255,0.4);">
                        <p style="font-size: 1.3rem; font-weight: 800; margin-bottom: 10px; text-align: center;">
                            üí° <strong>Â§öÂï¶AÂ§¢Âª∫Ë≠∞ÈÅ©Â∫¶Ë®ÇË≥º ${suggestedOrder} ÂÄãÁ•ûÂ•áÂñÆ‰ΩçÔºÅ</strong>
                        </p>
                        <p style="font-size: 1.1rem; font-weight: 600; text-align: center; opacity: 0.9;">
                            Doraemon suggests moderate ordering of ${suggestedOrder} magic units!
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üîç <span>ÊîæÂ§ßÈè°Á≤æÊ∫ñÂàÜÊûê</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üìâ Ë£úË∂≥Â∫´Â≠òÁº∫Âè£Ôºö${shortfall} ÂñÆ‰Ωç</li>
                                <li>üìä È†êÊúüÂπ≥ÂùáÈúÄÊ±ÇÔºö${Math.ceil(avgDemand)} ÂñÆ‰Ωç</li>
                                <li>üöÄ ÊôÇÂÖâÊ©üÂú®ÈÄîÔºö${totalInPipeline} ÂñÆ‰Ωç</li>
                                <li>‚öñÔ∏è È¢®Èö™Ë©ï‰º∞Ôºö‰∏≠Á≠â</li>
                                <li><strong style="color: var(--doraemon-green);">üéØ Á≠ñÁï•ÔºöÁ©©ÂÅ•Ë£úË≤®</strong></li>
                            </ul>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üîç <span>Precise Analysis</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üìâ Fill inventory gap: ${shortfall} units</li>
                                <li>üìä Expected avg demand: ${Math.ceil(avgDemand)} units</li>
                                <li>üöÄ Time machine pipeline: ${totalInPipeline} units</li>
                                <li>‚öñÔ∏è Risk assessment: Medium</li>
                                <li><strong style="color: var(--doraemon-green);">üéØ Strategy: Stable restocking</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>`;
        }

        function generateDoraemonCostControlStrategy(inventory, avgDemand, totalInPipeline, suggestedOrder) {
            return `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.4rem;">
                        üí∞ <span>‰ΩøÁî®Á∏ÆÂ∞èÁáàÁØÄÁ¥ÑÊàêÊú¨Á≠ñÁï•ÔºÅ</span>
                    </h4>
                    <h5 style="margin-bottom: 10px; opacity: 0.9; font-size: 1.1rem;">
                        Use Shrinking Light Cost Saving Strategy!
                    </h5>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid rgba(255,255,255,0.4);">
                        <p style="font-size: 1.3rem; font-weight: 800; margin-bottom: 10px; text-align: center;">
                            üéØ <strong>Â§öÂï¶AÂ§¢Âª∫Ë≠∞‰øùÂÆàË®ÇË≥º ${suggestedOrder} ÂÄãÁ•ûÂ•áÂñÆ‰ΩçÔºÅ</strong>
                        </p>
                        <p style="font-size: 1.1rem; font-weight: 600; text-align: center; opacity: 0.9;">
                            Doraemon suggests conservative ordering of ${suggestedOrder} magic units!
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üíé <span>Á∏ÆÂ∞èÁáàÊàêÊú¨ÊéßÂà∂</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üì¶ ÂõõÊ¨°ÂÖÉÂè£Ë¢ãÂ∫´Â≠òÔºö${inventory} ÂñÆ‰ΩçÔºàÂÖÖË∂≥Ôºâ</li>
                                <li>üìà È†êÊúüÂ∏ÇÂ†¥ÈúÄÊ±ÇÔºö${Math.ceil(avgDemand)} ÂñÆ‰Ωç</li>
                                <li>‚è∞ ÊôÇÂÖâÊ©üÂú®ÈÄîÂ≠òË≤®Ôºö${totalInPipeline} ÂñÆ‰Ωç</li>
                                <li>üí∏ ÊàêÊú¨È¢®Èö™Á≠âÁ¥öÔºö‰Ωé</li>
                                <li><strong style="color: var(--doraemon-yellow);">üéØ ÈáçÈªûÔºöÈôç‰ΩéÂ∫´Â≠òÊàêÊú¨</strong></li>
                            </ul>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üíé <span>Cost Control Analysis</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üì¶ 4D Pocket inventory: ${inventory} units (sufficient)</li>
                                <li>üìà Expected market demand: ${Math.ceil(avgDemand)} units</li>
                                <li>‚è∞ Time machine pipeline: ${totalInPipeline} units</li>
                                <li>üí∏ Cost risk level: Low</li>
                                <li><strong style="color: var(--doraemon-yellow);">üéØ Focus: Reduce inventory costs</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>`;
        }

        function generateDoraemonStableStrategy(avgDemand, targetInventory, inventory, totalInPipeline, suggestedOrder) {
            return `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.4rem;">
                        ‚öñÔ∏è <span>‰ΩøÁî®Â§©Âπ≥‰øùÊåÅÂÆåÁæéÂπ≥Ë°°Á≠ñÁï•ÔºÅ</span>
                    </h4>
                    <h5 style="margin-bottom: 10px; opacity: 0.9; font-size: 1.1rem;">
                        Use Balance Scale Perfect Equilibrium Strategy!
                    </h5>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid rgba(255,255,255,0.4);">
                        <p style="font-size: 1.3rem; font-weight: 800; margin-bottom: 10px; text-align: center;">
                            ‚úÖ <strong>Â§öÂï¶AÂ§¢Âª∫Ë≠∞Á©©ÂÆöË®ÇË≥º ${suggestedOrder} ÂÄãÁ•ûÂ•áÂñÆ‰ΩçÔºÅ</strong>
                        </p>
                        <p style="font-size: 1.1rem; font-weight: 600; text-align: center; opacity: 0.9;">
                            Doraemon suggests stable ordering of ${suggestedOrder} magic units!
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üåü <span>Á•ûÂ•áÂπ≥Ë°°ÊåáÂçó</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üìä È†êÊúüÂ∏ÇÂ†¥ÈúÄÊ±ÇÔºö${Math.ceil(avgDemand)} ÂñÆ‰Ωç</li>
                                <li>üìà Â∫´Â≠òÁãÄÊÖãË™øÊï¥Ôºö${targetInventory - inventory} ÂñÆ‰Ωç</li>
                                <li>üöÄ ÊôÇÂÖâÈößÈÅì‰æõÊáâÔºö${totalInPipeline} ÂñÆ‰Ωç</li>
                                <li>üîÑ ÈÅãÁáüÁãÄÊÖãÔºöÂÆåÁæéÂπ≥Ë°°</li>
                                <li><strong style="color: var(--doraemon-blue);">üéØ ÁõÆÊ®ôÔºöÁ∂≠ÊåÅÁ•ûÂ•áÂπ≥Ë°°</strong></li>
                            </ul>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üåü <span>Magic Balance Guide</span>
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li>üìä Expected market demand: ${Math.ceil(avgDemand)} units</li>
                                <li>üìà Inventory adjustment: ${targetInventory - inventory} units</li>
                                <li>üöÄ Time tunnel supply: ${totalInPipeline} units</li>
                                <li>üîÑ Operation status: Perfect balance</li>
                                <li><strong style="color: var(--doraemon-blue);">üéØ Goal: Maintain magic balance</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>`;
        }

        function generateDoraemonCostAnalysis(currentCost, inventory, delay1, delay2, backorder) {
            return `
                <div style="margin-top: 25px; padding-top: 20px; border-top: 3px solid rgba(255,255,255,0.4);">
                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.4rem;">
                        üîÆ <span>Ë©≥Á¥∞ÊàêÊú¨ÂàÜÊûêÂ†±ÂëäÔºÅ</span>
                    </h4>
                    <h5 style="margin-bottom: 15px; opacity: 0.9; font-size: 1.1rem;">
                        Detailed Cost Analysis Report!
                    </h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üí∞ <span>‰∏≠ÊñáÊàêÊú¨ÊòéÁ¥∞</span>
                            </h5>
                            <div style="line-height: 2; font-size: 0.95rem;">
                                <p><strong>üèÜ Êú¨ÈÄ±È†ê‰º∞Á∏ΩÊàêÊú¨Ôºö${currentCost.toFixed(1)} ÂÖÉ</strong></p>
                                <p>‚îú‚îÄ üíé Â∫´Â≠òÊåÅÊúâÊàêÊú¨Ôºö${((inventory + delay1 + delay2) * 0.5).toFixed(1)} ÂÖÉ</p>
                                <p>‚îÇ  ‚îú‚îÄ üì¶ Â∫´Â≠òÔºö${inventory} √ó 0.5 = ${(inventory * 0.5).toFixed(1)} ÂÖÉ</p>
                                <p>‚îÇ  ‚îú‚îÄ ‚è∞ Âª∂ÈÅ≤1Ôºö${delay1} √ó 0.5 = ${(delay1 * 0.5).toFixed(1)} ÂÖÉ</p>
                                <p>‚îÇ  ‚îî‚îÄ ‚åõ Âª∂ÈÅ≤2Ôºö${delay2} √ó 0.5 = ${(delay2 * 0.5).toFixed(1)} ÂÖÉ</p>
                                <p>‚îî‚îÄ üö® Áº∫Ë≤®Êá≤ÁΩ∞ÊàêÊú¨Ôºö${(backorder * 1.0).toFixed(1)} ÂÖÉ</p>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.3);">
                            <h5 style="color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                üí∞ <span>English Cost Breakdown</span>
                            </h5>
                            <div style="line-height: 2; font-size: 0.95rem;">
                                <p><strong>üèÜ Weekly estimated total cost: ${currentCost.toFixed(1)}</strong></p>
                                <p>‚îú‚îÄ üíé Inventory holding cost: ${((inventory + delay1 + delay2) * 0.5).toFixed(1)}</p>
                                <p>‚îÇ  ‚îú‚îÄ üì¶ Inventory: ${inventory} √ó 0.5 = ${(inventory * 0.5).toFixed(1)}</p>
                                <p>‚îÇ  ‚îú‚îÄ ‚è∞ Delay1: ${delay1} √ó 0.5 = ${(delay1 * 0.5).toFixed(1)}</p>
                                <p>‚îÇ  ‚îî‚îÄ ‚åõ Delay2: ${delay2} √ó 0.5 = ${(delay2 * 0.5).toFixed(1)}</p>
                                <p>‚îî‚îÄ üö® Shortage penalty cost: ${(backorder * 1.0).toFixed(1)}</p>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        function processWeek() {
            const wholesalerOrder = parseInt(document.getElementById('wholesalerOrder').value);
            const actualShip = parseInt(document.getElementById('actualShip').value);
            const myOrder = parseInt(document.getElementById('myOrder').value);
            const newInventory = parseInt(document.getElementById('newInventory').value);
            const newDelay1 = parseInt(document.getElementById('newDelay1').value);
            const newDelay2 = parseInt(document.getElementById('newDelay2').value);

            // Ëº∏ÂÖ•È©óË≠â
            if ([wholesalerOrder, actualShip, newInventory, newDelay1, newDelay2].some(val => isNaN(val))) {
                showDoraemonAlert('ü§ñ Â§öÂï¶AÂ§¢ÊèêÈÜíÔºöË´ãÂ°´ÂÖ•ÊâÄÊúâÂü∫Á§éÊï∏ÊìöÔºÅ\nDoraemon reminds: Please fill in all basic data!', 'warning');
                return;
            }
            
            if (isNaN(myOrder)) {
                showDoraemonAlert('ü§ñ Â§öÂï¶AÂ§¢ÊèêÈÜíÔºöË´ãÊ±∫ÂÆöÂ∑•Âª†Ë®ÇË≥ºÊï∏ÈáèÔºÅÂª∫Ë≠∞ÂÖàÈªûÊìäAIÂª∫Ë≠∞\nDoraemon reminds: Please decide factory order quantity! Try AI suggestion first', 'warning');
                return;
            }

            // Ë®àÁÆóÊñ∞ÁãÄÊÖã
            const newBackorder = Math.max(0, gameState.backorder + wholesalerOrder - actualShip);
            const weeklyCost = calculateCost(newInventory, newDelay1, newDelay2, newBackorder);

            // Êõ¥Êñ∞ÈÅäÊà≤ÁãÄÊÖã
            gameState.currentWeek++;
            gameState.inventory = newInventory;
            gameState.delay1 = newDelay1;
            gameState.delay2 = newDelay2;
            gameState.backorder = newBackorder;
            gameState.weeklyCost = weeklyCost;
            gameState.totalCost += weeklyCost;

            // Ë®òÈåÑÊ≠∑Âè≤
            gameState.history.push({
                week: gameState.currentWeek,
                wholesalerOrder: wholesalerOrder,
                actualShip: actualShip,
                myOrder: myOrder,
                inventory: newInventory,
                delay1: newDelay1,
                delay2: newDelay2,
                backorder: newBackorder,
                weeklyCost: weeklyCost,
                totalCost: gameState.totalCost
            });

            // Êõ¥Êñ∞È°ØÁ§∫
            updateDisplay();
            updateProgressBar();
            updateHistoryTable();
            
            // Èö±ËóèAIÂª∫Ë≠∞
            document.getElementById('aiSuggestion').style.display = 'none';
            clearInputs();

            // Ê™¢Êü•ÈÅäÊà≤ÁµêÊùü
            if (gameState.currentWeek >= 60) {
                setTimeout(() => {
                    showDoraemonGameEnd();
                }, 500);
                return;
            }

            // È°ØÁ§∫ËôïÁêÜÊàêÂäüÊèêÁ§∫
            showDoraemonAlert(`‚úÖ Á¨¨${gameState.currentWeek}ÈÄ±Êï∏ÊìöËôïÁêÜÂÆåÊàêÔºÅ\n‚úÖ Week ${gameState.currentWeek} data processed successfully!`, 'success');
        }

        function showDoraemonAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'doraemon-alert';
            alertDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">ü§ñ</span>
                    <div style="font-weight: 600;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 4000);
        }

        function showDoraemonGameEnd() {
            const endMessage = `
                üéâ ÊÅ≠ÂñúÔºÅÂ§öÂï¶AÂ§¢ÁöÑ‰æõÊáâÈèàÂÜíÈö™ÂÆåÊàê‰∫ÜÔºÅ üéâ
                Congratulations! Doraemon's Supply Chain Adventure Complete!
                
                üèÜ ÊúÄÁµÇÁµ±Ë®à Final Statistics:
                ‚Ä¢ 60ÈÄ±Á∏ΩÊàêÊú¨ Total Cost: ${gameState.totalCost.toFixed(1)} ÂÖÉ/$
                ‚Ä¢ Âπ≥ÂùáÈÄ±ÊàêÊú¨ Average Weekly Cost: ${(gameState.totalCost/60).toFixed(1)} ÂÖÉ/$
                
                ü§ñ Â§öÂï¶AÂ§¢Ë™™Ôºö„Äå‰Ω†ÂÅöÂæóÂæàÊ£íÔºÅ‰æõÊáâÈèàÁÆ°ÁêÜÁúüÊòØÁ•ûÂ•áÁöÑÂ≠∏ÂïèÂë¢ÔºÅ„Äç
                Doraemon says: "You did great! Supply chain management is truly amazing!"
                
                ‚ú® Ë¨ùË¨ù‰Ω†ÂíåÂ§öÂï¶AÂ§¢‰∏ÄËµ∑Â≠∏ÁøíÔºÅ Thank you for learning with Doraemon! ‚ú®
            `;
            alert(endMessage);
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = `<tr>
                <td>0</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>4</td>
                <td>4</td>
                <td>4</td>
                <td>0</td>
                <td>6.0</td>
                <td>6.0</td>
            </tr>`;

            gameState.history.forEach(record => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${record.week}</td>
                    <td>${record.wholesalerOrder}</td>
                    <td>${record.actualShip}</td>
                    <td>${record.myOrder !== null ? record.myOrder : '-'}</td>
                    <td>${record.inventory}</td>
                    <td>${record.delay1}</td>
                    <td>${record.delay2}</td>
                    <td>${record.backorder}</td>
                    <td>${record.weeklyCost.toFixed(1)}</td>
                    <td>${record.totalCost.toFixed(1)}</td>
                `;
            });
        }

        function clearInputs() {
            ['wholesalerOrder', 'actualShip', 'newInventory', 'newDelay1', 'newDelay2'].forEach(id => {
                const input = document.getElementById(id);
                input.value = '';
                input.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    input.style.transform = 'scale(1)';
                }, 200);
            });
            
            // Ê∏ÖÁ©∫Ë®ÇÂñÆËº∏ÂÖ•Ôºå‰ΩÜ‰∏çÂÅöÂãïÁï´ÔºàÂõ†ÁÇ∫ÈÄôÊòØÊ±∫Á≠ñÊÄßËº∏ÂÖ•Ôºâ
            document.getElementById('myOrder').value = '';
        }

        function resetGame() {
            const confirmMessage = 'ü§ñ Â§öÂï¶AÂ§¢ÂïèÔºöÁ¢∫ÂÆöË¶ÅÈáçÊñ∞ÈñãÂßãÈÅäÊà≤ÂóéÔºü\nDoraemon asks: Are you sure to restart the game?';
            
            if (confirm(confirmMessage)) {
                // ÈáçÁΩÆÈÅäÊà≤ÁãÄÊÖã
                gameState = {
                    currentWeek: 0,
                    inventory: 4,
                    delay1: 4,
                    delay2: 4,
                    backorder: 0,
                    weeklyCost: 6.0,
                    totalCost: 6.0,
                    history: []
                };
                
                // Êõ¥Êñ∞ÊâÄÊúâÈ°ØÁ§∫
                updateDisplay();
                updateProgressBar();
                updateHistoryTable();
                clearInputs();
                setDefaultWeekData();
                
                // Èö±ËóèAIÂª∫Ë≠∞
                document.getElementById('aiSuggestion').style.display = 'none';
                
                // È°ØÁ§∫ÈáçÁΩÆÊàêÂäüÊèêÁ§∫
                showDoraemonAlert('üîÑ ÈÅäÊà≤ÈáçÊñ∞ÈñãÂßãÔºÅGame restarted!', 'success');
            }
        }

        function showGameHelp() {
            const helpContent = `
                ü§ñ Â§öÂï¶AÂ§¢ÁöÑ‰æõÊáâÈèàÁÆ°ÁêÜÊåáÂçó | Doraemon's Supply Chain Management Guide
                
                üìö Êìç‰ΩúÊ≠•È©ü Operation Steps:
                1Ô∏è‚É£ ËßÄÂØüÁï∂ÂâçÁãÄÊÖã Check current status (Â∫´Â≠ò„ÄÅÂª∂ÈÅ≤Á≠â)
                2Ô∏è‚É£ Ëº∏ÂÖ•ÊØèÈÄ±Êï∏Êìö Input weekly data (Ë®ÇÂñÆ„ÄÅÂá∫Ë≤®Á≠â)
                3Ô∏è‚É£ ‰ΩøÁî®„ÄåAIÂª∫Ë≠∞„ÄçÁç≤ÂæóÁ≠ñÁï• Use "AI Suggestion" for strategy
                4Ô∏è‚É£ ÈªûÊìä„ÄåÊñΩÂ±ïÈ≠îÊ≥ï„ÄçËôïÁêÜ Click "Cast Magic" to process
                5Ô∏è‚É£ ÈáçË§á60ÈÄ±ÂÆåÊàêÊåëÊà∞ Repeat for 60 weeks to complete
                
                üéØ ÈÅäÊà≤ÁõÆÊ®ôÔºöÊúÄÂ∞èÂåñ60ÈÄ±Á∏ΩÊàêÊú¨ÔºÅ
                üéØ Game Goal: Minimize total cost over 60 weeks!
                
                üí° ÈáçË¶ÅÊèêÈÜíÔºöÊØèÂÄãÊ±∫Á≠ñÈÉΩÊúÉÂΩ±ÈüøÊú™‰æÜÂπæÈÄ±ÁöÑÊàêÊú¨ÔºÅ
                üí° Important: Every decision affects costs for future weeks!
            `;
            alert(helpContent);
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂü∑Ë°å
        updateDisplay();
        updateProgressBar();
    </script>
</body>
</html>
